from __future__ import annotations

from pathlib import Path
from utils.state import TestState


def write_markdown_summary(state: TestState, path: Path) -> None:
    lines = []
    lines.append(f"# Account Takeover Pre-Auth Test (Skeleton)\n")
    lines.append(f"- Target: {state.url}\n")
    lines.append(f"- Email: {state.test_email or 'N/A'}\n")
    lines.append(f"- Vulnerability Found: {state.vulnerability_found}\n")
    if state.vulnerability_details:
        lines.append(f"- Details: {state.vulnerability_details}\n")
    lines.append("\n## Steps\n")
    for step in state.steps:
        lines.append(f"- {step.name}: {step.status} - {step.message or ''}\n")
    # Remediation guidance scaffold
    if state.vulnerability_found:
        lines.append("\n## Remediation Guidance\n")
        lines.append("- Finding: Pre-auth account takeover via SSO pre-registration\n")
        lines.append("- Impact: Attacker may hijack account prior to legitimate SSO registration\n")
        lines.append("- Remediation: Enforce email ownership prior to SSO linking; block pre-registration reuse; add conflict-resolution flow\n")
        lines.append("- Priority: High\n")
    path.write_text("".join(lines), encoding="utf-8")


