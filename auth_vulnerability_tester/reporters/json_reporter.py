from __future__ import annotations

import json
from pathlib import Path
from typing import Any

from utils.state import TestState


def write_json_report(state: TestState, path: Path) -> None:
    payload: dict[str, Any] = {
        "url": state.url,
        "test_email": state.test_email,
        "steps": [s.model_dump() for s in state.steps],
        "errors": [e.model_dump() for e in state.errors],
        "verification_required": state.verification_required,
        "account_identifier": state.account_identifier,
        "storage_artifacts": state.storage_artifacts,
        "vulnerability_found": state.vulnerability_found,
        "vulnerability_details": state.vulnerability_details,
        "runtime": state.runtime,
    }
    path.write_text(json.dumps(payload, indent=2), encoding="utf-8")


