from __future__ import annotations

import random
import asyncio
from playwright.async_api import Locator


async def human_delay(min_seconds: float = 1.0, max_seconds: float = 3.0) -> None:
    await asyncio.sleep(random.uniform(min_seconds, max_seconds))


async def human_type(locator: Locator, text: str) -> None:
    for ch in text:
        await locator.type(ch, delay=random.randint(50, 120))
        # occasional micro pauses
        if random.random() < 0.08:
            await asyncio.sleep(random.uniform(0.05, 0.2))


async def mouse_movement(page, steps: int = 10):
    box = await page.evaluate("() => ({ w: window.innerWidth, h: window.innerHeight })")
    x, y = random.randint(0, box["w"]), random.randint(0, box["h"])
    await page.mouse.move(x, y)
    for _ in range(steps):
        x = min(max(x + random.randint(-50, 50), 0), box["w"])
        y = min(max(y + random.randint(-50, 50), 0), box["h"])
        await page.mouse.move(x, y, steps=random.randint(5, 20))
        await asyncio.sleep(random.uniform(0.05, 0.2))


async def scroll_behavior(page, segments: int = 3):
    for _ in range(segments):
        await page.mouse.wheel(0, random.randint(200, 800))
        await asyncio.sleep(random.uniform(0.3, 0.8))


